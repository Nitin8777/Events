<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EventHub Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-50 text-gray-800">
    <!-- Navbar -->
    <nav class="bg-indigo-600 p-4 text-white flex justify-between">
      <h1 class="text-2xl font-bold">Add Event</h1>
      <div class="space-x-4">
        <a
          href="registrations.html"
          class="bg-white text-indigo-600 px-4 py-1 rounded"
          >Registrations</a
        >
        <button
          onclick="loadStudents() "
          class="bg-white text-indigo-600 px-4 py-1 rounded"
        >
          Refresh Events
        </button>
        <a href="index.html" class="bg-white text-indigo-600 px-4 py-1 rounded"
          >Student View</a
        >
      </div>
    </nav>

    <!-- Event Form -->
    <section class="container mx-auto py-10 max-w-lg">
      <h2 class="text-3xl font-bold text-center mb-6">Add New Event</h2>
      <form id="eventForm" class="space-y-4 bg-white shadow-md p-6 rounded">
        <input
          type="text"
          name="title"
          placeholder="Event Title"
          class="w-full border px-4 py-2 rounded"
          required
        />
        <input
          type="date"
          name="date"
          class="w-full border px-4 py-2 rounded"
          required
        />
        <input
          type="text"
          name="location"
          placeholder="Event Location"
          class="w-full border px-4 py-2 rounded"
          required
        />
        <textarea
          name="description"
          placeholder="Event Description"
          class="w-full border px-4 py-2 rounded"
          required
        ></textarea>
        <button class="w-full bg-indigo-600 text-white py-2 rounded">
          Add Event
        </button>
        <p id="formMessage" class="text-center mt-2"></p>
      </form>
    </section>

    <!-- Events List -->
    <section class="container mx-auto py-10">
      <h2 class="text-2xl font-bold mb-6">All Events</h2>
      <div id="eventList" class="grid md:grid-cols-2 gap-6"></div>
    </section>

    <script>
      const API_URL = "http://localhost:5000/api";

      // Handle Add Event
      document
        .getElementById("eventForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const formData = Object.fromEntries(new FormData(e.target));

          const res = await fetch(`${API_URL}/events`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(formData),
          });

          const messageEl = document.getElementById("formMessage");
          if (res.ok) {
            messageEl.textContent = "âœ… Registration successful!";
            messageEl.className = "text-green-600 text-center mt-2";
            e.target.reset();
          } else {
            messageEl.textContent =
              "âŒ " + (data.message || "Registration failed.");
            messageEl.className = "text-red-600 text-center mt-2";
          }

          loadEvents();
        });

      // Load Events
      async function loadEvents() {
        const res = await fetch(`${API_URL}/events`);
        const events = await res.json();
        const eventList = document.getElementById("eventList");
        eventList.innerHTML = "";

        events.forEach((ev) => {
          eventList.innerHTML += `
      <div class="bg-white shadow rounded p-4 relative">
        <h4 class="text-xl font-bold">${ev.title}</h4>
        <p class="text-gray-600">ğŸ“… ${ev.date} | ğŸ“ ${ev.location}</p>
        <p class="mt-2">${ev.description}</p>
        <button onclick="deleteEvent('${ev._id}')" class="absolute top-2 right-2 bg-red-500 text-white px-3 py-1 rounded">Delete</button>
      </div>
    `;
        });
      }

      // Delete Event
      async function deleteEvent(id) {
        if (!confirm("Are you sure you want to delete this event?")) return;
        await fetch(`${API_URL}/events/${id}`, { method: "DELETE" });
        loadEvents();
      }

      loadEvents();
    </script>
  </body>
</html>
